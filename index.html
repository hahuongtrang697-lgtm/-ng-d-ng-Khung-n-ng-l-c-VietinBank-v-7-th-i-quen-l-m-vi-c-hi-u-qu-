<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VietinBank: NƒÉng L·ª±c & Hi·ªáu Qu·∫£</title>
    <style>
        :root {
            --primary: #00a8e1; /* M√†u th∆∞∆°ng hi·ªáu VietinBank xanh nh·∫°t */
            --secondary: #003a70; /* M√†u VietinBank xanh ƒë·∫≠m */
            --accent: #ed1c24; /* M√†u ƒë·ªè ƒëi·ªÉm nh·∫•n */
            --bg: #f4f7f9; --text: #333; --success: #28a745; --error: #dc3545;
        }
        * { box-sizing: border-box; font-family: 'Arial', sans-serif; }
        body { margin: 0; background: var(--bg); color: var(--text); overflow: hidden; display: flex; flex-direction: column; height: 100vh; }
        
        header {
            height: 70px; background: var(--secondary); display: flex; align-items: center; 
            padding: 0 20px; justify-content: space-between; border-bottom: 4px solid var(--primary);
            color: white;
        }
        .stats { display: flex; gap: 15px; font-size: 1rem; }
        .btn { padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .btn-teacher { background: #6c757d; color: white; margin-left: 10px; }
        
        #game-container { flex: 1; position: relative; display: flex; justify-content: center; align-items: center; background: #e0e0e0; }
        canvas { background: white; border: 5px solid var(--secondary); box-shadow: 0 10px 25px rgba(0,0,0,0.2); max-width: 95%; max-height: 85vh; }
        
        .overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 58, 112, 0.95); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 20; text-align: center; color: white; padding: 20px; }
        .hidden { display: none !important; }
        
        .quiz-card { background: white; color: #333; padding: 30px; border-radius: 15px; max-width: 550px; width: 95%; border-top: 10px solid var(--primary); }
        .options { display: grid; gap: 12px; margin-top: 20px; }
        .opt-btn { padding: 15px; border: 2px solid #ddd; border-radius: 8px; background: #f8f9fa; cursor: pointer; text-align: left; font-size: 1rem; font-weight: 500; }
        .opt-btn:hover { background: #e9ecef; border-color: var(--primary); }
        
        input[type="text"] { padding: 15px; width: 300px; border-radius: 8px; border: none; font-size: 1.1rem; margin-bottom: 20px; text-align: center; }
        
        /* B·∫£ng ƒëi·ªÉm gi√°o vi√™n */
        #leaderboard-overlay { overflow-y: auto; padding: 40px; }
        table { width: 100%; max-width: 800px; background: white; color: #333; border-collapse: collapse; border-radius: 10px; overflow: hidden; }
        th, td { padding: 12px; border: 1px solid #ddd; text-align: center; }
        th { background: var(--primary); color: white; }
        tr:nth-child(even) { background: #f2f2f2; }
    </style>
</head>
<body>

<header>
    <div style="display: flex; flex-direction: column;">
        <span style="font-size: 0.9rem; font-weight: bold; color: var(--primary);">VIETINBANK LEARNING</span>
        <span style="font-size: 1.1rem; font-weight: bold;">·ª®ng d·ª•ng Khung nƒÉng l·ª±c & 7 Th√≥i quen</span>
    </div>
    <div class="stats">
        <span>üë§: <b id="display-name">...</b></span>
        <span>‚è±: <b id="timer">00:00</b></span>
        <span>üèÜ: <b id="score">0</b></span>
        <button class="btn btn-teacher" onclick="toggleTeacher()">Teacher Mode</button>
    </div>
</header>

<div id="game-container">
    <canvas id="gameCanvas"></canvas>

    <div id="menu-overlay" class="overlay">
        <h1 style="margin-bottom: 10px;">CH√ÄO M·ª™NG B·∫†N</h1>
        <p style="margin-bottom: 30px;">Nh·∫≠p t√™n ƒë·ªÉ b·∫Øt ƒë·∫ßu b√†i √¥n t·∫≠p</p>
        <input type="text" id="student-name" placeholder="Nh·∫≠p H·ªç v√† T√™n c·ªßa b·∫°n..." maxlength="30">
        <div style="margin-bottom: 30px;">
            <select id="level-select" style="padding: 12px; border-radius: 8px; width: 300px;">
                <option value="easy">C·∫•p ƒë·ªô: KI·∫æN TH·ª®C N·ªÄN</option>
                <option value="medium">C·∫•p ƒë·ªô: HI·ªÇU & V·∫¨N D·ª§NG</option>
                <option value="hard">C·∫•p ƒë·ªô: T√åNH HU·ªêNG TH·ª∞C T·∫æ</option>
            </select>
        </div>
        <button class="btn" style="background: var(--primary); color: white; padding: 18px 60px; font-size: 1.2rem;" onclick="validateAndStart()">V√ÄO THI NGAY</button>
    </div>

    <div id="quiz-overlay" class="overlay hidden">
        <div class="quiz-card">
            <h3 id="question-text" style="margin-top:0">...</h3>
            <div id="options-container" class="options"></div>
            <p id="feedback" style="margin-top: 20px; font-weight: bold; font-size: 1.1rem;"></p>
        </div>
    </div>

    <div id="result-overlay" class="overlay hidden">
        <h2 style="color: var(--primary);">HO√ÄN TH√ÄNH B√ÄI THI!</h2>
        <div style="background: white; color: #333; padding: 30px; border-radius: 15px; margin: 20px 0;">
            <p>Ch√∫c m·ª´ng: <b id="res-name">...</b></p>
            <p>ƒêi·ªÉm s·ªë ƒë·∫°t ƒë∆∞·ª£c: <b id="res-score" style="font-size: 2rem; color: var(--success);">0</b></p>
            <p>Th·ªùi gian: <b id="res-time">0</b></p>
        </div>
        <button class="btn" style="background: var(--secondary); color: white;" onclick="location.reload()">L√†m l·∫°i</button>
    </div>

    <div id="leaderboard-overlay" class="overlay hidden">
        <h2 style="color: white;">DANH S√ÅCH K·∫æT QU·∫¢ C·∫¢ L·ªöP</h2>
        <table id="score-table">
            <thead>
                <tr>
                    <th>STT</th>
                    <th>H·ªç v√† T√™n</th>
                    <th>B·ªô ƒë·ªÅ</th>
                    <th>ƒêi·ªÉm</th>
                    <th>Th·ªùi gian</th>
                    <th>Ng√†y thi</th>
                </tr>
            </thead>
            <tbody id="score-body"></tbody>
        </table>
        <div style="margin-top: 20px;">
            <button class="btn" style="background: var(--error); color: white;" onclick="clearData()">X√≥a t·∫•t c·∫£ d·ªØ li·ªáu</button>
            <button class="btn" style="background: #ccc; margin-left: 10px;" onclick="closeTeacher()">ƒê√≥ng</button>
        </div>
    </div>
</div>

<script>
// --- CONFIGURATION ---
const CONFIG = {
    settings: { gridSize: 20, fps: 6, teacherPass: "123" },
    data: {
        easy: [
            { q: "NƒÉng l·ª±c n√†o l√† c·ªët l√µi c·ªßa nh√¢n vi√™n VietinBank?", a: ["Tin c·∫≠y", "C√° nh√¢n", "T·ª± do"], c: 0 },
            { q: "Th√≥i quen 1 trong 7 th√≥i quen l√† g√¨?", a: ["Lu√¥n ch·ªß ƒë·ªông", "B·∫Øt ƒë·∫ßu v·ªõi m·ª•c ti√™u", "∆Øu ti√™n vi·ªác quan tr·ªçng"], c: 0 },
            { q: "Ch·ªØ A trong m√¥ h√¨nh ASK nghƒ©a l√†?", a: ["Attitude (Th√°i ƒë·ªô)", "Ability (Kh·∫£ nƒÉng)", "Action (H√†nh ƒë·ªông)"], c: 0 },
            { q: "VietinBank h∆∞·ªõng t·ªõi gi√° tr·ªã c·ªët l√µi n√†o?", a: ["Kh√°ch h√†ng l√† trung t√¢m", "L·ª£i nhu·∫≠n l√† tr√™n h·∫øt", "C·∫°nh tranh b·∫±ng m·ªçi gi√°"], c: 0 },
            { q: "Th√≥i quen n√†o gi√∫p r√®n luy·ªán b·∫£n th√¢n m·ªói ng√†y?", a: ["M√†i l∆∞·ª°i c∆∞a", "Th·∫•u hi·ªÉu", "H·ª£p l·ª±c"], c: 0 },
            { q: "K·ªπ nƒÉng giao ti·∫øp chuy√™n nghi·ªáp thu·ªôc nh√≥m nƒÉng l·ª±c n√†o?", a: ["NƒÉng l·ª±c h√†nh vi", "NƒÉng l·ª±c chuy√™n m√¥n", "NƒÉng l·ª±c qu·∫£n l√Ω"], c: 0 },
            { q: "S·∫Øp x·∫øp h·ªì s∆° khoa h·ªçc th·ªÉ hi·ªán th√≥i quen n√†o?", a: ["NgƒÉn n·∫Øp", "∆Øu ti√™n vi·ªác quan tr·ªçng", "T∆∞ duy c√πng th·∫Øng"], c: 1 },
            { q: "L√†m vi·ªác nh√≥m hi·ªáu qu·∫£ d·ª±a tr√™n t∆∞ duy n√†o?", a: ["C√πng th·∫Øng (Win-Win)", "Th·∫Øng - Thua", "T√¥i th·∫Øng l√† ƒë∆∞·ª£c"], c: 0 },
            { q: "ƒê√¢u l√† m·ªôt th√≥i quen gi√∫p l√†m vi·ªác hi·ªáu qu·∫£?", a: ["ƒêa nhi·ªám xao nh√£ng", "L√™n k·∫ø ho·∫°ch ng√†y", "ƒêi mu·ªôn v·ªÅ s·ªõm"], c: 1 },
            { q: "VietinBank ƒë·ªÅ cao t√≠nh tu√¢n th·ªß trong c√¥ng vi·ªác ƒë√∫ng hay sai?", a: ["ƒê√∫ng", "Sai"], c: 0 }
        ],
        medium: [
            { q: "Khi g·∫∑p v·∫•n ƒë·ªÅ ph√°t sinh t·∫°i qu·∫ßy, th√≥i quen 'Ch·ªß ƒë·ªông' th·ªÉ hi·ªán qua?", a: ["Ch·ªù s·∫øp ch·ªâ ƒë·∫°o", "T√¨m gi·∫£i ph√°p h·ªó tr·ª£ ngay", "ƒê·ªï l·ªói cho h·ªá th·ªëng"], c: 1 },
            { q: "Th√≥i quen 'Th·∫•u hi·ªÉu' gi√∫p g√¨ trong t∆∞ v·∫•n kh√°ch h√†ng?", a: ["N√≥i nhi·ªÅu h∆°n kh√°ch", "Nghe ƒë·ªÉ hi·ªÉu nhu c·∫ßu th·∫≠t", "B√°n nhanh nh·∫•t c√≥ th·ªÉ"], c: 1 },
            { q: "Ma tr·∫≠n Eisenhower gi√∫p ph√¢n lo·∫°i vi·ªác theo?", a: ["Nhanh - Ch·∫≠m", "Kh·∫©n c·∫•p - Quan tr·ªçng", "D·ªÖ - Kh√≥"], c: 1 },
            { q: "NƒÉng l·ª±c 'Th√≠ch ·ª©ng' gi√∫p c√°n b·ªô VietinBank?", a: ["S·ª£ thay ƒë·ªïi", "Linh ho·∫°t trong m√¥i tr∆∞·ªùng m·ªõi", "Ch·ªâ l√†m vi·ªác c≈©"], c: 1 },
            { q: "K·∫øt qu·∫£ c·ªßa th√≥i quen 'H·ª£p l·ª±c' l√† g√¨?", a: ["1+1=2", "1+1 > 2", "1+1 < 2"], c: 1 }
            // C√≥ th·ªÉ th√™m th√™m c√¢u h·ªèi ·ªü ƒë√¢y...
        ],
        hard: [
            { q: "Theo khung nƒÉng l·ª±c VietinBank, 'Ch√≠nh tr·ª±c' ƒë∆∞·ª£c hi·ªÉu l√†?", a: ["L√†m ƒë√∫ng c·∫£ khi kh√¥ng ai nh√¨n", "L√†m ƒë√∫ng khi b·ªã gi√°m s√°t", "Ch·ªâ c·∫ßn kh√¥ng vi ph·∫°m ph√°p lu·∫≠t"], c: 0 },
            { q: "ƒê·ªÉ m√†i l∆∞·ª°i c∆∞a v·ªÅ tr√≠ tu·ªá, b·∫°n n√™n l√†m g√¨?", a: ["Ng·ªß nhi·ªÅu h∆°n", "H·ªçc th√™m k·ªπ nƒÉng m·ªõi", "L√†m vi·ªác kh√¥ng ngh·ªâ"], c: 1 }
            // C√≥ th·ªÉ th√™m th√™m c√¢u h·ªèi ·ªü ƒë√¢y...
        ]
    }
};

let canvas, ctx, snake, food, direction, nextDirection, score, gameTimer, seconds, questions, currentQIdx, isPaused, gameState, playerName;
const GS = CONFIG.settings.gridSize;

function init() {
    canvas = document.getElementById('gameCanvas');
    ctx = canvas.getContext('2d');
    resize();
    document.addEventListener('keydown', handleKeys);
}

function resize() {
    canvas.width = 600; canvas.height = 400;
}

function validateAndStart() {
    playerName = document.getElementById('student-name').value.trim();
    if (!playerName) { alert("Vui l√≤ng nh·∫≠p t√™n c·ªßa b·∫°n!"); return; }
    document.getElementById('display-name').innerText = playerName;
    startGame();
}

function startGame() {
    const lv = document.getElementById('level-select').value;
    questions = [...CONFIG.data[lv]];
    currentQIdx = 0; score = 0; seconds = 0;
    snake = [{x: 5, y: 5}, {x: 4, y: 5}];
    direction = 'RIGHT'; nextDirection = 'RIGHT';
    isPaused = false; gameState = 'PLAYING';
    
    document.getElementById('menu-overlay').classList.add('hidden');
    document.getElementById('result-overlay').classList.add('hidden');
    
    spawnFood();
    if(gameTimer) clearInterval(gameTimer);
    gameTimer = setInterval(update, 1000 / CONFIG.settings.fps);
}

function update() {
    if(isPaused || gameState !== 'PLAYING') return;
    seconds += (1/CONFIG.settings.fps);
    updateTimerDisplay();

    direction = nextDirection;
    const head = {...snake[0]};
    if(direction === 'UP') head.y--;
    if(direction === 'DOWN') head.y++;
    if(direction === 'LEFT') head.x--;
    if(direction === 'RIGHT') head.x++;

    if(head.x < 0 || head.x >= canvas.width/GS || head.y < 0 || head.y >= canvas.height/GS || snake.some(s => s.x === head.x && s.y === head.y)) {
        endGame(); return;
    }

    snake.unshift(head);
    if(head.x === food.x && head.y === food.y) {
        showQuiz();
    } else {
        snake.pop();
    }
    draw();
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    // Food
    ctx.fillStyle = varColor('--accent');
    ctx.beginPath(); ctx.arc(food.x*GS+GS/2, food.y*GS+GS/2, GS/2-2, 0, Math.PI*2); ctx.fill();

    // Snake
    snake.forEach((part, i) => {
        ctx.fillStyle = i === 0 ? varColor('--secondary') : varColor('--primary');
        ctx.beginPath();
        ctx.roundRect(part.x*GS+1, part.y*GS+1, GS-2, GS-2, i===0?8:4);
        ctx.fill();
        // M·∫Øt cho ƒë·∫ßu
        if(i === 0) {
            ctx.fillStyle = "white";
            ctx.fillRect(part.x*GS+12, part.y*GS+4, 4, 4);
            ctx.fillRect(part.x*GS+12, part.y*GS+12, 4, 4);
        }
    });
}

function showQuiz() {
    isPaused = true;
    const q = questions[currentQIdx];
    document.getElementById('question-text').innerText = q.q;
    const container = document.getElementById('options-container');
    container.innerHTML = '';
    document.getElementById('feedback').innerText = '';
    
    q.a.forEach((opt, i) => {
        const btn = document.createElement('button');
        btn.className = 'opt-btn'; btn.innerText = opt;
        btn.onclick = () => {
            if(i === q.c) {
                score += 10;
                document.getElementById('feedback').innerText = "CH√çNH X√ÅC! +10ƒë";
                document.getElementById('feedback').style.color = "green";
                setTimeout(nextStep, 800);
            } else {
                document.getElementById('feedback').innerText = "SAI R·ªíI! R·∫Øn b·ªã ng·∫Øn ƒëi.";
                document.getElementById('feedback').style.color = "red";
                if(snake.length > 1) snake.pop();
                setTimeout(nextStep, 1200);
            }
        };
        container.appendChild(btn);
    });
    document.getElementById('quiz-overlay').classList.remove('hidden');
}

function nextStep() {
    currentQIdx++;
    document.getElementById('score').innerText = score;
    document.getElementById('quiz-overlay').classList.add('hidden');
    isPaused = false;
    spawnFood();
    if(currentQIdx >= questions.length) endGame();
}

function spawnFood() {
    food = { x: Math.floor(Math.random()*(canvas.width/GS)), y: Math.floor(Math.random()*(canvas.height/GS)) };
}

function handleKeys(e) {
    const k = e.keyCode;
    if((k===37 || k===65) && direction!=='RIGHT') nextDirection='LEFT';
    if((k===38 || k===87) && direction!=='DOWN') nextDirection='UP';
    if((k===39 || k===68) && direction!=='LEFT') nextDirection='RIGHT';
    if((k===40 || k===83) && direction!=='UP') nextDirection='DOWN';
}

function updateTimerDisplay() {
    const m = Math.floor(seconds/60).toString().padStart(2,'0');
    const s = Math.floor(seconds%60).toString().padStart(2,'0');
    document.getElementById('timer').innerText = `${m}:${s}`;
}

function endGame() {
    gameState = 'END';
    clearInterval(gameTimer);
    saveResult();
    document.getElementById('result-overlay').classList.remove('hidden');
    document.getElementById('res-name').innerText = playerName;
    document.getElementById('res-score').innerText = score;
    document.getElementById('res-time').innerText = document.getElementById('timer').innerText;
}

function saveResult() {
    const results = JSON.parse(localStorage.getItem('vtbank_results') || '[]');
    results.push({
        name: playerName,
        level: document.getElementById('level-select').value,
        score: score,
        time: document.getElementById('timer').innerText,
        date: new Date().toLocaleString('vi-VN')
    });
    localStorage.setItem('vtbank_results', JSON.stringify(results));
}

function toggleTeacher() {
    const p = prompt("Nh·∫≠p m√£ gi√°o vi√™n:");
    if(p === CONFIG.settings.teacherPass) {
        showLeaderboard();
    }
}

function showLeaderboard() {
    const results = JSON.parse(localStorage.getItem('vtbank_results') || '[]');
    const body = document.getElementById('score-body');
    body.innerHTML = '';
    results.sort((a,b) => b.score - a.score).forEach((r, i) => {
        body.innerHTML += `<tr><td>${i+1}</td><td>${r.name}</td><td>${r.level}</td><td>${r.score}</td><td>${r.time}</td><td>${r.date}</td></tr>`;
    });
    document.getElementById('leaderboard-overlay').classList.remove('hidden');
}

function closeTeacher() { document.getElementById('leaderboard-overlay').classList.add('hidden'); }
function clearData() { if(confirm("X√≥a s·∫°ch danh s√°ch ƒëi·ªÉm?")) { localStorage.removeItem('vtbank_results'); showLeaderboard(); } }
function varColor(name) { return getComputedStyle(document.documentElement).getPropertyValue(name).trim(); }

init();
</script>
</body>
</html>
